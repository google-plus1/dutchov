<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERLC Bus Scheduler</title>
<style>
body {
  font-family: 'Segoe UI', sans-serif;
  margin:0;
  padding:0;
  background:#1a1a2e;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
}
h1,h2 { text-align:center; margin:0 0 10px 0; }
.container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; padding:20px; width:100%; max-width:1200px; }
.card { background:#162447; border-radius:16px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.5); width:350px; display:flex; flex-direction:column; align-items:center; }
input, select, button { width:100%; padding:10px; margin:6px 0; border-radius:10px; border:none; font-size:16px; }
button { background:#e43f5a; color:white; cursor:pointer; font-weight:bold; transition:0.3s; }
button:hover { background:#d3314f; }
.info { margin:10px 0; width:100%; text-align:center; }
.big { font-size:22px; color:#f7b32b; }
.timetable { width:100%; max-width:450px; background:#1f4068; border-radius:16px; padding:15px; box-shadow:0 8px 20px rgba(0,0,0,0.5); }
table { width:100%; border-collapse:collapse; }
th, td { padding:8px; text-align:left; border-bottom:1px solid #333; }
th { background:#e43f5a; color:white; border-radius:8px; }
#activeDrivers { position:fixed; bottom:20px; left:20px; background:#0f3460; padding:15px; border-radius:12px; min-width:180px; }
#activeDrivers h3 { margin:0 0 10px 0; font-size:18px; color:#f7b32b; }
#stationControls button { margin:5px; }
#status { margin-top:10px; font-weight:bold; }
#timerDisplay {
  margin-top:10px;
  font-size:24px;
  padding:8px 16px;
  border-radius:8px;
  background:#1cc88a;
  color:#fff;
  min-width:100px;
  text-align:center;
  transition:background 0.3s;
}
</style>
</head>
<body>

<h1>ERLC Bus Scheduler</h1>

<div class="container">
  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <div id="loginMsg" style="color:red; margin-top:10px;"></div>
  </div>

  <!-- BUS CONTROLS -->
  <div class="card" id="busCard" style="display:none;">
    <h2>Bus Schedule</h2>
    <select id="lineSelect"></select>
    <button id="confirmBtn">Select Route</button>

    <div class="info"><span>Current Time:</span><br><span id="currentTime" class="big"></span></div>
    <div class="info"><span>Next Departure:</span><br><span id="nextDeparture" class="big"></span></div>
    <div class="info"><span>Countdown:</span><br><span id="countdown" class="big"></span></div>

    <div id="stationControls" style="display:none;">
      <button id="departBtn">Depart</button>
      <button id="nextBtn">Next Station</button>
      <button id="endBtn">End</button>
      <div id="timerDisplay">--:--</div>
      <div id="status"></div>
    </div>
  </div>

  <!-- TIMETABLE -->
  <div class="timetable" id="timetableCard" style="display:none;">
    <h2 id="tableTitle">Timetable</h2>
    <table>
      <thead><tr><th>Stop</th><th>Arrival</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<!-- Active Drivers -->
<div id="activeDrivers" style="display:none;">
  <h3>Active Drivers</h3>
  <ul id="driversList"></ul>
</div>

<script>
// ===== USERS =====
const users = { "pwatg123":"utrechtov20092025", "Roidky":"Mohamed4obai", "driver":"pass123" };

// ===== BUS LINES =====
const lines = {
  "Line A": { freq:10, stops:[{name:"Spawn",offset:0},{name:"Brandweer Kazerene",offset:1},{name:"Independence Parkway",offset:2},{name:"Centraal Station",offset:3},{name:"Maple Valley Farms",offset:4},{name:"Highrock Park",offset:5}] },
  "Line B": { freq:15, stops:[{name:"Central Park",offset:0},{name:"Ouchard Boulevard",offset:1},{name:"Ouchard Boulevard 2",offset:2},{name:"Independence Parkway",offset:3},{name:"Medical Way",offset:4},{name:"Maple Valley Farms",offset:5},{name:"Highrock Park",offset:6}] },
  "Line C": { freq:10, stops:[{name:"Spawn",offset:0},{name:"Chinatown",offset:1},{name:"Fire Department",offset:2},{name:"Central Park",offset:3},{name:"Hospital",offset:4},{name:"Farms",offset:5},{name:"Highrock",offset:6},{name:"Springfield",offset:7}] },
  "Event Shuttle": { freq:15, stops:[{name:"Spawn",offset:0},{name:"Event Center",offset:4}] }
};

// ===== DOM ELEMENTS =====
const loginCard=document.getElementById("loginCard");
const busCard=document.getElementById("busCard");
const timetableCard=document.getElementById("timetableCard");
const loginBtn=document.getElementById("loginBtn");
const usernameEl=document.getElementById("username");
const passwordEl=document.getElementById("password");
const loginMsg=document.getElementById("loginMsg");
const select=document.getElementById("lineSelect");
const confirmBtn=document.getElementById("confirmBtn");
const currentTimeEl=document.getElementById("currentTime");
const nextDepartureEl=document.getElementById("nextDeparture");
const countdownEl=document.getElementById("countdown");
const tableBody=document.getElementById("tableBody");
const tableTitle=document.getElementById("tableTitle");

const stationControls=document.getElementById("stationControls");
const departBtn=document.getElementById("departBtn");
const nextBtn=document.getElementById("nextBtn");
const endBtn=document.getElementById("endBtn");
const timerDisplay=document.getElementById("timerDisplay");
const statusDiv=document.getElementById("status");

const activeDriversDiv=document.getElementById("activeDrivers");
const driversList=document.getElementById("driversList");

// ===== STATE =====
let selectedLine=null;
let currentStopIndex=0;
let expectedTime=null;
let timerInterval=null;
let countingDown=true;
let activeDrivers=[];

// ===== LOGIN =====
loginBtn.addEventListener("click",()=>{
  const username=usernameEl.value;
  const password=passwordEl.value;
  if(users[username] && users[username]===password){
    loginCard.style.display="none";
    busCard.style.display="block";
    timetableCard.style.display="block";
    addActiveDriver(username);
    initBusUI();
  } else loginMsg.textContent="Invalid username or password!";
});

function addActiveDriver(username){
  if(!activeDrivers.includes(username)) activeDrivers.push(username);
  driversList.innerHTML="";
  activeDrivers.forEach(u=>{
    const li=document.createElement("li");
    li.textContent=u;
    driversList.appendChild(li);
  });
  activeDriversDiv.style.display="block";
}

// ===== BUS UI =====
function initBusUI(){
  select.innerHTML="";
  for(let name in lines){
    const opt=document.createElement("option");
    opt.value=name;
    opt.textContent=name;
    select.appendChild(opt);
  }
  confirmBtn.addEventListener("click",()=>{
    selectedLine=lines[select.value];
    tableTitle.textContent=`${select.value} Timetable`;
    generateTimetable(selectedLine);
    currentStopIndex=0;
    stationControls.style.display="block";
    statusDiv.textContent="";
    timerDisplay.textContent="--:--";
    timerDisplay.style.background="#1cc88a";
  });
  setInterval(updateTime,1000);
  updateTime();
}

function getNextDeparture(now,freq){
  const mins=now.getMinutes();
  const rem=mins%freq;
  const next=new Date(now);
  const add=rem===0?freq:freq-rem;
  next.setMinutes(mins+add);
  next.setSeconds(0,0);
  return next;
}
function formatTime(date){ return date.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }

function generateTimetable(line){
  tableBody.innerHTML="";
  const nextDeparture=getNextDeparture(new Date(),line.freq);
  line.stops.forEach(stop=>{
    const tr=document.createElement("tr");
    const tdStop=document.createElement("td");
    const tdTime=document.createElement("td");
    tdStop.textContent=stop.name;
    const arrival=new Date(nextDeparture.getTime()+stop.offset*60000);
    tdTime.textContent=formatTime(arrival);
    tr.append(tdStop, tdTime);
    tableBody.appendChild(tr);
  });
}

function updateTime(){
  const now=new Date();
  currentTimeEl.textContent = now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  if(!selectedLine){
    nextDepartureEl.textContent="--:--";
    countdownEl.textContent="Select a line";
    return;
  }
  const freq=selectedLine.freq;
  const next=getNextDeparture(now,freq);
  const diff=next-now;
  const mins=Math.floor(diff/60000);
  const secs=Math.floor((diff%60000)/1000);
  nextDepartureEl.textContent=formatTime(next);
  countdownEl.textContent=`${mins}m ${secs}s`;
}

// ===== TIMER / STATIONS =====
departBtn.addEventListener("click",()=>{
  if(!selectedLine) return;
  currentStopIndex=0;
  startStopTimer();
  statusDiv.textContent=`Departed: ${selectedLine.stops[currentStopIndex].name}`;
});

nextBtn.addEventListener("click",()=>{
  if(!selectedLine || currentStopIndex>=selectedLine.stops.length-1) return;
  clearInterval(timerInterval);
  const timeDiff=(expectedTime - new Date())/1000;
  if(timeDiff>0){
    statusDiv.textContent="On Time ✅";
  } else {
    statusDiv.textContent="Late ❌";
  }
  currentStopIndex++;
  startStopTimer();
});

endBtn.addEventListener("click",()=>{
  clearInterval(timerInterval);
  statusDiv.textContent="Route Completed!";
  timerDisplay.textContent="--:--";
  timerDisplay.style.background="#1cc88a";
});

function startStopTimer(){
  clearInterval(timerInterval);
  const now=new Date();
  expectedTime=new Date(now.getTime()+60000); // each stop = 1 min
  countingDown=true;
  updateTimer();
  timerInterval=setInterval(updateTimer,1000);
}

function updateTimer(){
  const now=new Date();
  let diff=(expectedTime-now)/1000;
  if(diff>0){
    // still on time
    timerDisplay.style.background="#1cc88a";
    timerDisplay.textContent=formatDiff(diff);
  } else {
    // late
    timerDisplay.style.background="#e43f5a";
    timerDisplay.textContent=`-${formatDiff(Math.abs(diff))}`;
  }
}

function formatDiff(sec){
  const m=Math.floor(sec/60);
  const s=Math.floor(sec%60);
  return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}
</script>
</body>
</html>
