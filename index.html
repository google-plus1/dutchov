<script>

  
  /* ------------------------- Storage keys & defaults ------------------------- */
const STORAGE_ROUTES = 'erlc_routes_v2';
const STORAGE_LOGS = 'erlc_logs_v2';
const STORAGE_USERS = 'erlc_users_v2';

const defaultUsers = {
  "pwatg123admin": { pw: "utrechtov20092025", admin:true },
  "Roidkyadmin":   { pw: "Mohamed4obai", admin:true },
  "Roidky":        { pw: "Mohamed4obai", admin:false },
  "pwatg123":      { pw: "utrechtov20092025", admin:false },
  "Ilias123":      { pw: "Pass123", admin:false },
  "milandepro7":   { pw: "Utrechtov20702025", admin:false },
  "blobvisje.":    { pw: "pass123", admin:false }
};

const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1429903434366193734/DRdYl52p-VEVzDjyxgwxrzZR3zZvZUy-oxMAR9C82YF67iMemQdddDIu71gKl0veKdtM";

const defaultRoutes = {
  "Line A": { freq:10, stops:[ "Spawn","Chinatown","Central Park","Highrock" ] },
  "Line C": { freq:10, stops:[ "Spawn","Chinatown","Fire Department","Central Park","Hospital","Farms","Highrock","Springfield" ] },
  "FastLine": { freq:8, stops:[ "Springfield","River City" ] }
};

/* ------------------------- Storage helpers ------------------------- */
function saveRoutes(routes){ localStorage.setItem(STORAGE_ROUTES, JSON.stringify(routes)); ROUTES = routes; }
function saveUsers(users){ localStorage.setItem(STORAGE_USERS, JSON.stringify(users)); USERS = users; }
function saveLogs(logs){ localStorage.setItem(STORAGE_LOGS, JSON.stringify(logs)); LOGS = logs; }

function loadRoutes(){
  let r = localStorage.getItem(STORAGE_ROUTES);
  if(!r){
    const temp = JSON.parse(JSON.stringify(defaultRoutes));
    for(const name in defaultRoutes){
      const revName = name+" 2";
      temp[revName] = { freq: defaultRoutes[name].freq, stops:[...defaultRoutes[name].stops].reverse() };
    }
    saveRoutes(temp);
    return temp;
  }
  return JSON.parse(r);
}

function loadUsers(){
  let u = localStorage.getItem(STORAGE_USERS);
  if(!u){ saveUsers(defaultUsers); return defaultUsers; }
  return JSON.parse(u);
}

function loadLogs(){ let l = localStorage.getItem(STORAGE_LOGS); return l?JSON.parse(l):[]; }

let ROUTES = loadRoutes();
let USERS = loadUsers();
let LOGS = loadLogs();

/* ------------------------- DOM elements ------------------------- */
const usernameEl = document.getElementById('username');
const passwordEl = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginMsg = document.getElementById('loginMsg');

const driverControls = document.getElementById('driverControls');
const lineSelect = document.getElementById('lineSelect');
const confirmBtn = document.getElementById('confirmBtn');
const reverseBtn = document.getElementById('reverseBtn');

const currentTime = document.getElementById('currentTime');
const nextDeparture = document.getElementById('nextDeparture');
const countdown = document.getElementById('countdown');

const stationControls = document.getElementById('stationControls');
const departBtn = document.getElementById('departBtn');
const nextBtn = document.getElementById('nextBtn');
const endBtn = document.getElementById('endBtn');
const timerDisplay = document.getElementById('timerDisplay');
const statusDiv = document.getElementById('status');

const timetableCard = document.getElementById('timetableCard');
const tableTitle = document.getElementById('tableTitle');
const tableBody = document.getElementById('tableBody');

const activeDriversDiv = document.getElementById('activeDrivers');
const driversList = document.getElementById('driversList');
const userBadge = document.getElementById('userBadge');

const adminPanel = document.getElementById('adminPanel');
const routesList = document.getElementById('routesList');
const logsList = document.getElementById('logsList');
const addRouteBtn = document.getElementById('addRouteBtn');
const newRouteName = document.getElementById('newRouteName');
const newRouteFreq = document.getElementById('newRouteFreq');
const newRouteStops = document.getElementById('newRouteStops');
const refreshRoutesBtn = document.getElementById('refreshRoutesBtn');
const clearLogsBtn = document.getElementById('clearLogsBtn');
const exportLogsBtn = document.getElementById('exportLogsBtn');




