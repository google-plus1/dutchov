<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERLC Bus Scheduler</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #a8edea, #fed6e3);
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  h1 { color: #333; margin-top: 20px; }
  .container {
    display: flex; flex-wrap: wrap;
    justify-content: center; gap: 20px;
    padding: 20px; max-width: 1200px; width: 100%;
  }
  .card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    padding: 25px;
    width: 340px;
    display: flex; flex-direction: column;
    align-items: center;
  }
  input, select, button {
    width: 100%; padding: 10px; margin: 8px 0;
    border-radius: 10px; border: 1px solid #ccc;
    font-size: 16px;
  }
  button {
    background: #ff7e5f; color: white; border: none; cursor: pointer;
    font-weight: bold; transition: 0.3s;
  }
  button:hover { background: #eb6750; }
  .info { text-align: center; margin: 8px 0; }
  .big { font-size: 20px; color: #ff7e5f; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { padding: 8px; border-bottom: 1px solid #eee; text-align: left; }
  th { background: #ff7e5f; color: white; }
  .admin-panel { display: none; width: 90%; max-width: 700px; margin: 20px auto; background: white; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 20px; }
  .log-entry { border-bottom: 1px solid #ddd; padding: 5px; }
</style>
</head>
<body>

<h1>ERLC Bus Scheduler</h1>

<div class="container">

  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <h2>Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" placeholder="Password" type="password">
    <button id="loginBtn">Login</button>
    <div id="loginMsg" style="color:red;margin-top:10px;"></div>
  </div>

  <!-- BUS CONTROL -->
  <div class="card" id="busCard" style="display:none;">
    <h2>Bus Schedule</h2>
    <select id="lineSelect"></select>
    <button id="loadBtn">Load Timetable</button>
    <button id="departBtn" style="display:none;">Depart</button>

    <div class="info"><b>Current Time:</b><br><span id="currentTime" class="big"></span></div>
    <div class="info"><b>Next Departure:</b><br><span id="nextDeparture" class="big"></span></div>

    <table id="timetableTable">
      <thead><tr><th>Stop</th><th>Time</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

</div>

<!-- ADMIN PANEL -->
<div class="admin-panel" id="adminPanel">
  <h2>Admin Panel</h2>
  <button id="viewLogs">View Shift Logs</button>
  <div id="logContainer"></div>
</div>

<script>
// ========== USERS ==========
const users = {
  "pwatg123admin": { pw:"utrechtov20092025", admin:true },
  "Roidkyadmin": { pw:"Mohamed4obai", admin:true },
  "Roidky": { pw:"Mohamed4obai", admin:false },
  "pwatg123": { pw:"utrechtov20092025", admin:false },
  "ilias4real.": { pw:"OVIlias239", admin:false },
  "milandepro7": { pw:"Utrechtov20702025", admin:false },
  "driver": { pw:"pass123", admin:false }
};

// ========== ROUTES ==========
const routes = {
  "Line A": { freq:10, stops:["Spawn (Depart)","Brandweer Kazerene","Central Park","Centraal Station","Maple Valley Farms","Highrock Park (End)"] },
  "Line A2": { freq:10, stops:["Highrock Park (Depart)","Maple Valley Farms","Centraal Station","Central Park","Brandweer Kazerene","Spawn (End)"] },
  "Line B": { freq:15, stops:["Central Park (Depart)","Ouchard Boulevard","Ouchard Boulevard 2","Central Park","Medical Way","Maple Valley Farms","Highrock Park (End)"] },
  "Line C": { freq:10, stops:["Spawn (Depart)","Chinatown","Fire Department","Central Park","Hospital","Farms","Highrock","Springfield (End)"] },
  "FastLine Springfield-River City": { freq:20, stops:["Springfield","Highrock","Hospital","Central Park","Fire Department","Spawn","River City"] }
};

// ========== ELEMENTS ==========
const loginCard=document.getElementById("loginCard");
const busCard=document.getElementById("busCard");
const adminPanel=document.getElementById("adminPanel");
const username=document.getElementById("username");
const password=document.getElementById("password");
const loginBtn=document.getElementById("loginBtn");
const loginMsg=document.getElementById("loginMsg");
const lineSelect=document.getElementById("lineSelect");
const loadBtn=document.getElementById("loadBtn");
const departBtn=document.getElementById("departBtn");
const tableBody=document.getElementById("tableBody");
const currentTime=document.getElementById("currentTime");
const nextDeparture=document.getElementById("nextDeparture");
const viewLogs=document.getElementById("viewLogs");
const logContainer=document.getElementById("logContainer");

const DISCORD_WEBHOOK_URL = "YOUR_WEBHOOK_URL_HERE";
let CURRENT_USER=null, IS_ADMIN=false, selectedRoute=null, selectedRouteName=null;
let LOGS=JSON.parse(localStorage.getItem("shiftLogs")||"[]");

// ========== LOGIN ==========
loginBtn.addEventListener("click",()=>{
  const user=username.value.trim();
  const pw=password.value.trim();
  if(users[user] && users[user].pw===pw){
    CURRENT_USER=user;
    IS_ADMIN=users[user].admin;
    loginCard.style.display="none";
    busCard.style.display="block";
    if(IS_ADMIN) adminPanel.style.display="block";
    initBusUI();
  } else loginMsg.textContent="Invalid username or password";
});

// ========== TIME ==========
setInterval(()=>{
  const now=new Date();
  currentTime.textContent=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
},1000);

// ========== INITIALIZE ==========
function initBusUI(){
  for(let r in routes){
    const opt=document.createElement("option");
    opt.value=r; opt.textContent=r;
    lineSelect.appendChild(opt);
  }
}

// ========== NEXT DEPARTURE ==========
function getNextDeparture(now,freq){
  const mins=now.getMinutes();
  const next = new Date(now);
  const rem = mins % freq;
  const add = rem===0?freq:freq-rem;
  next.setMinutes(mins+add); next.setSeconds(0,0);
  return next;
}

// ========== RENDER TIMETABLE ==========
function renderTimetable(route, departTime){
  tableBody.innerHTML='';
  route.stops.forEach((stop,i)=>{
    const tr=document.createElement('tr');
    const tdStop=document.createElement('td'); tdStop.textContent=stop;
    const tdTime=document.createElement('td');
    const arrival=new Date(departTime.getTime()+i*60000);
    tdTime.textContent=arrival.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    tr.append(tdStop,tdTime);
    tableBody.appendChild(tr);
  });
}

// ========== BUTTONS ==========
loadBtn.addEventListener("click",()=>{
  selectedRouteName=lineSelect.value;
  selectedRoute=routes[selectedRouteName];
  if(!selectedRoute) return;
  const next=getNextDeparture(new Date(),selectedRoute.freq);
  nextDeparture.textContent=next.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  renderTimetable(selectedRoute,next);
  departBtn.style.display="block";
});

departBtn.addEventListener("click",()=>{
  const actualDepart=new Date();
  const scheduled=getNextDeparture(new Date(),selectedRoute.freq);
  const diffMinutes=Math.round((actualDepart - scheduled)/60000);
  tableBody.innerHTML='';
  selectedRoute.stops.forEach((stop,i)=>{
    const tr=document.createElement('tr');
    const tdStop=document.createElement('td'); tdStop.textContent=stop;
    const tdTime=document.createElement('td');
    const arrival=new Date(actualDepart.getTime()+i*60000);
    let text=arrival.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    if(diffMinutes>0) text+=` <span style="color:red;font-size:0.9em;">+${diffMinutes}</span>`;
    else if(diffMinutes<0) text+=` <span style="color:green;font-size:0.9em;">${diffMinutes}</span>`;
    tdTime.innerHTML=text;
    tr.append(tdStop,tdTime);
    tableBody.appendChild(tr);
  });
  logShift(CURRENT_USER, selectedRouteName, actualDepart);
});

// ========== SHIFT LOGS ==========
function logShift(user,route,time){
  const entry={user,route,time:new Date(time).toISOString()};
  LOGS.unshift(entry);
  localStorage.setItem("shiftLogs",JSON.stringify(LOGS));
  sendShiftLogToDiscord(user,route,time);
}

// ========== DISCORD WEBHOOK ==========
function sendShiftLogToDiscord(user,route,time){
  if(!DISCORD_WEBHOOK_URL || DISCORD_WEBHOOK_URL==="YOUR_WEBHOOK_URL_HERE") return;
  fetch(DISCORD_WEBHOOK_URL,{
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({content:`ðŸšŒ **Shift Log**\nDriver: **${user}**\nRoute: **${route}**\nDeparted: ${new Date(time).toLocaleTimeString()}`})
  }).catch(console.error);
}

// ========== ADMIN PANEL ==========
viewLogs.addEventListener("click",()=>{
  logContainer.innerHTML='';
  if(!LOGS.length){ logContainer.textContent="No logs yet."; return; }
  LOGS.forEach((l,i)=>{
    const div=document.createElement('div');
    div.className="log-entry";
    div.innerHTML=`${i+1}. <b>${l.user}</b> - ${l.route} @ ${new Date(l.time).toLocaleTimeString()}`;
    const delBtn=document.createElement('button');
    delBtn.textContent="Delete";
    delBtn.onclick=()=>{ LOGS.splice(i,1); localStorage.setItem("shiftLogs",JSON.stringify(LOGS)); viewLogs.click(); };
    div.appendChild(delBtn);
    logContainer.appendChild(div);
  });
});
</script>
</body>
</html>


