<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ERLC Bus Scheduler — Admin & Drivers</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#ff6b6b; --muted:#9aa4c0; --good:#1cc88a; --bad:#e43f5a;
    --panel:#0f3460;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background:linear-gradient(180deg,#071024 0%, #0e1530 100%); color:#edf2f7;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  header{padding:18px 24px;border-bottom:1px solid rgba(255,255,255,.03);display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:18px}
  .wrap{display:flex;gap:20px;padding:20px;max-width:1200px;margin:20px auto}
  .card{background:var(--card);border-radius:12px;padding:18px;width:360px;box-shadow:0 6px 30px rgba(2,6,23,.6)}
  .wide{flex:1;min-width:360px;padding:18px}
  label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
  input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:0;font-size:14px}
  textarea{min-height:88px;resize:vertical}
  button{background:var(--accent);color:#fff;border:0;cursor:pointer}
  .muted{color:var(--muted);font-size:13px}
  .infoRow{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px}
  .big{font-weight:700;font-size:18px}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,.03);font-size:14px}
  th{color:#fff;background:linear-gradient(90deg,var(--accent),#ff907a);border-radius:6px}
  .smallBtn{padding:6px 8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted);cursor:pointer}
  #activeDrivers{position:fixed;left:18px;bottom:18px;background:var(--panel);padding:12px;border-radius:10px;min-width:200px;box-shadow:0 8px 30px rgba(0,0,0,.6)}
  #activeDrivers h3{margin:0 0 6px 0;color:var(--good);font-size:14px}
  .timer{
    margin-top:12px;padding:10px;border-radius:8px;text-align:center;font-weight:700;font-size:20px;color:#fff;background:var(--good);min-width:120px
  }
  .status{margin-top:8px;font-weight:600}
  .adminPanel{background:#07183a;padding:12px;border-radius:10px}
  .row{display:flex;gap:8px}
  .row > *{flex:1}
  .mutedSmall{font-size:12px;color:var(--muted)}
  .logItem{display:flex;justify-content:space-between;gap:10px;align-items:center;padding:8px;border-radius:6px;background:rgba(255,255,255,.02);margin-bottom:8px}
  .danger{background:rgba(228,63,90,.08);border:1px solid rgba(228,63,90,.12);color:var(--bad);padding:6px 8px;border-radius:8px}
  .ok{background:rgba(28,200,138,.06);border:1px solid rgba(28,200,138,.12);color:var(--good);padding:6px 8px;border-radius:8px}
  .inlineSmall{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,.02);color:var(--muted);font-size:13px}
</style>
</head>
<body>

<header>
  <h1>ERLC Bus Scheduler</h1>
  <div style="margin-left:auto" class="mutedSmall">Local demo — data saved in browser storage</div>
</header>

<div class="wrap">
  <!-- left column: login + controls -->
  <div class="card">
    <div id="loginSection">
      <h2 style="margin:0 0 8px 0">Login</h2>
      <label>Username</label>
      <input id="username" placeholder="Username" />
      <label>Password</label>
      <input id="password" type="password" placeholder="Password" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="loginBtn">Login</button>
        <button id="logoutBtn" style="display:none;background:#6c757d">Logout</button>
      </div>
      <div id="loginMsg" class="mutedSmall" style="margin-top:8px;color:#ffb4b4"></div>
    </div>

    <div id="driverControls" style="display:none;margin-top:12px">
      <h3 style="margin:0 0 8px 0">Driver Controls</h3>
      <label>Choose Line</label>
      <select id="lineSelect"></select>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="confirmBtn">Load Timetable</button>
        <button id="reverseBtn" title="Toggle original/return" class="smallBtn">Reverse</button>
      </div>

      <div class="infoRow">
        <div>
          <div class="mutedSmall">Current time</div>
          <div id="currentTime" class="big"></div>
        </div>
        <div style="text-align:right">
          <div class="mutedSmall">Next departure</div>
          <div id="nextDeparture" class="big">--:--</div>
        </div>
      </div>

      <div style="margin-top:10px">
        <div class="mutedSmall">Countdown to next departure</div>
        <div id="countdown" class="timer">--:--</div>
      </div>

      <div id="stationControls" style="display:none;margin-top:12px">
        <div style="display:flex;gap:8px">
          <button id="departBtn">Depart</button>
          <button id="nextBtn" disabled>Next Station</button>
          <button id="endBtn">End</button>
        </div>
        <div id="timerDisplay" class="timer" style="margin-top:10px;background:var(--good)">--:--</div>
        <div id="status" class="status mutedSmall"></div>
        <div style="margin-top:8px" class="mutedSmall">*You may click <strong>Next Station</strong> only during the last <strong>15 seconds</strong> before arrival or when late.</div>
      </div>
    </div>
  </div>

  <!-- middle: timetable / logs -->
  <div class="wide card" style="min-width:520px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0">Timetable & Admin</h2>
      <div id="userBadge" class="inlineSmall" style="display:none"></div>
    </div>

    <div id="timetableCard" style="margin-top:12px; display:none">
      <div class="mutedSmall">Timetable for <strong id="tableTitle"></strong></div>
      <table id="timetableTable">
        <thead><tr><th>Stop</th><th>Arrival</th></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- admin panel (visible to admins only) -->
    <div id="adminPanel" style="margin-top:16px;display:none" class="adminPanel">
      <h3 style="margin:0 0 8px 0;color:var(--good)">Admin Panel</h3>

      <div style="display:flex;gap:10px">
        <div style="flex:1">
          <label>New Route name</label>
          <input id="newRouteName" placeholder="e.g. Line X" />
          <label>Frequency (minutes)</label>
          <input id="newRouteFreq" placeholder="10" />
          <label>Stops (one per line or comma separated)</label>
          <textarea id="newRouteStops" placeholder="Spawn&#10;Chinatown&#10;Fire Department"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="addRouteBtn">Add Route</button>
            <button id="refreshRoutesBtn" class="smallBtn">Refresh</button>
          </div>
        </div>

        <div style="width:260px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="mutedSmall">Routes</div>
            <div class="mutedSmall">Actions</div>
          </div>
          <div id="routesList" style="margin-top:8px;max-height:280px;overflow:auto"></div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,.03);margin:12px 0">

      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <div class="mutedSmall">Shift Logs</div>
          <div id="logsList" style="margin-top:8px;max-height:220px;overflow:auto"></div>
        </div>
        <div style="width:220px">
          <div class="mutedSmall">Admin Actions</div>
          <div style="margin-top:8px;display:flex;flex-direction:column;gap:8px">
            <button id="clearLogsBtn" class="smallBtn">Clear All Logs</button>
            <button id="exportLogsBtn" class="smallBtn">Export Logs (JSON)</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- active drivers -->
<div id="activeDrivers" style="display:none">
  <h3>Active Drivers</h3>
  <ul id="driversList" style="margin:0;padding-left:18px"></ul>
</div>

<script>
/* --- Storage & defaults --- */
const STORAGE_ROUTES = 'erlc_routes_v1';
const STORAGE_LOGS = 'erlc_logs_v1';
const STORAGE_USERS = 'erlc_users_v1';

const defaultUsers = {
  "pwatg123admin": { pw: "utrechtov20092025", admin:true },
  "Roidkyadmin":   { pw: "Mohamed4obai", admin:true },
  "Roidky":   { pw: "Mohamed4obai", admin:false },
  "pwatg123":   { pw: "utrechtov20092025", admin:false },
  "ilias4real.":   { pw: "OVIlias239", admin:false },
  "milandepro7":   { pw: "Utrechtov20702025", admin:false },
  "driver":   { pw: "pass123", admin:false },
  "driver":   { pw: "pass123", admin:false },
};

const defaultRoutes = {
  "Line A": { freq:10, stops:[ "Spawn","Brandweer Kazerene","Central Park","Centraal Station","Maple Valley Farms","Highrock Park" ] },
  "Event Shuttle": { freq:15, stops:[ "Spawn","Event Center" ] },
  "Line B": { freq:15, stops:[ "Central Park","Ouchard Boulevard","Ouchard Boulevard 2","Central Park","Medical Way","Maple Valley Farms","Highrock Park" ] },
  "Line C": { freq:10, stops:[ "Spawn","Chinatown","Fire Department","Central Park","Hospital","Farms","Highrock","Springfield" ] },
  "FastLine": { freq:8, stops:[ "Springfield","River City" ] },
  "Line D": { freq:10, stops:[ "Spawn","Chinatown","Fire Department","Central Park","Hospital","Farms","Highrock","Springfield" ] }
};

function saveRoutes(routes){ localStorage.setItem(STORAGE_ROUTES, JSON.stringify(routes)); ROUTES = routes; }
function loadRoutes(){
  const raw = localStorage.getItem(STORAGE_ROUTES);
  if(!raw){
    const r = JSON.parse(JSON.stringify(defaultRoutes));
    for(const name of Object.keys(defaultRoutes)){
      const revName = name + " 2";
      if(!r[revName]){
        r[revName] = { freq: defaultRoutes[name].freq, stops: [...defaultRoutes[name].stops].slice().reverse() };
      }
    }
    saveRoutes(r);
    return r;
  }
  return JSON.parse(raw);
}

function saveUsers(users){ localStorage.setItem(STORAGE_USERS, JSON.stringify(users)); }
function loadUsers(){
  const raw = localStorage.getItem(STORAGE_USERS);
  if(!raw){ saveUsers(defaultUsers); return defaultUsers; }
  return JSON.parse(raw);
}

function saveLogs(logs){ localStorage.setItem(STORAGE_LOGS, JSON.stringify(logs)); LOGS = logs; }
function loadLogs(){ const raw = localStorage.getItem(STORAGE_LOGS); return raw? JSON.parse(raw): []; }

/* --- App state --- */
let ROUTES = loadRoutes();
let LOGS = loadLogs();
let USERS = loadUsers();
let CURRENT_USER = null;
let CURRENT_USER_IS_ADMIN = false;
let selectedRouteName = null;
let selectedRoute = null;
let useReverse = false;
let expectedArrival = null;
let timerInterval = null;
let currentStopIndex = 0;
let activeDrivers = [];

/* --- DOM elements --- */
const usernameEl = document.getElementById('username');
const passwordEl = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginMsg = document.getElementById('loginMsg');
const driverControls = document.getElementById('driverControls');
const lineSelect = document.getElementById('lineSelect');
const confirmBtn = document.getElementById('confirmBtn');
const reverseBtn = document.getElementById('reverseBtn');
const currentTime = document.getElementById('currentTime');
const nextDeparture = document.getElementById('nextDeparture');
const countdown = document.getElementById('countdown');
const stationControls = document.getElementById('stationControls');
const departBtn = document.getElementById('departBtn');
const nextBtn = document.getElementById('nextBtn');
const endBtn = document.getElementById('endBtn');
const timerDisplay = document.getElementById('timerDisplay');
const statusDiv = document.getElementById('status');
const timetableCard = document.getElementById('timetableCard');
const tableTitle = document.getElementById('tableTitle');
const tableBody = document.getElementById('tableBody');
const activeDriversDiv = document.getElementById('activeDrivers');
const driversList = document.getElementById('driversList');
const userBadge = document.getElementById('userBadge');
const adminPanel = document.getElementById('adminPanel');
const routesList = document.getElementById('routesList');
const logsList = document.getElementById('logsList');
const addRouteBtn = document.getElementById('addRouteBtn');
const newRouteName = document.getElementById('newRouteName');
const newRouteFreq = document.getElementById('newRouteFreq');
const newRouteStops = document.getElementById('newRouteStops');
const refreshRoutesBtn = document.getElementById('refreshRoutesBtn');
const clearLogsBtn = document.getElementById('clearLogsBtn');
const exportLogsBtn = document.getElementById('exportLogsBtn');

/* -------------------------
   Login / Logout
------------------------- */
loginBtn.addEventListener('click', () => {
  const u = usernameEl.value.trim();
  const p = passwordEl.value;
  loginMsg.textContent = '';
  if(!u || !p){ loginMsg.textContent = 'Enter username & password'; return; }
  const userRecord = USERS[u];
  if(!userRecord || userRecord.pw !== p){ loginMsg.textContent = 'Invalid username or password'; return; }
  CURRENT_USER = u;
  CURRENT_USER_IS_ADMIN = !!userRecord.admin;
  loginMsg.textContent = '';
  document.getElementById('loginSection').style.display = 'none';
  driverControls.style.display = 'block';
  logoutBtn.style.display='inline-block';
  userBadge.style.display='inline-block';
  userBadge.textContent = `${CURRENT_USER}${CURRENT_USER_IS_ADMIN? ' (admin)':''}`;
  addActiveDriver(CURRENT_USER);
  populateRoutesSelect();
  if(CURRENT_USER_IS_ADMIN) { adminPanel.style.display='block'; populateAdminRoutes(); populateLogs(); }
});

logoutBtn.addEventListener('click', ()=> {
  CURRENT_USER = null; CURRENT_USER_IS_ADMIN=false;
  document.getElementById('loginSection').style.display='block';
  driverControls.style.display='none';
  adminPanel.style.display='none';
  timetableCard.style.display='none';
  stationControls.style.display='none';
  activeDriversDiv.style.display='none';
  logoutBtn.style.display='none';
  userBadge.style.display='none';
});

/* --- Active drivers --- */
function addActiveDriver(name){
  if(!name) return;
  if(!activeDrivers.includes(name)) activeDrivers.push(name);
  renderActiveDrivers();
}
function renderActiveDrivers(){
  driversList.innerHTML='';
  activeDrivers.forEach(d=>{
    const li = document.createElement('li'); li.textContent = d; driversList.appendChild(li);
  });
  activeDriversDiv.style.display = activeDrivers.length? 'block':'none';
}

/* -------------------------
   Routes / Timetable
------------------------- */
function populateRoutesSelect(){
  lineSelect.innerHTML='';
  const names = Object.keys(ROUTES).sort();
  names.forEach(n=>{
    const opt = document.createElement('option');
    opt.value = n; opt.textContent = n;
    lineSelect.appendChild(opt);
  });
  if(names.length) lineSelect.value = names[0];
}

confirmBtn.addEventListener('click', ()=> {
  selectedRouteName = lineSelect.value;
  useReverse = false;
  loadSelectedRoute();
});
reverseBtn.addEventListener('click', ()=>{
  if(!selectedRouteName) return;
  useReverse = !useReverse;
  loadSelectedRoute();
});

function loadSelectedRoute(){
  if(!selectedRouteName) return;
  const name = selectedRouteName;
  selectedRoute = ROUTES[name];
  let displayName = name;
  if(useReverse){
    const revName = name.endsWith(' 2')? name.replace(/ 2$/, '') : (name + ' 2');
    if(ROUTES[revName]){ selectedRoute = ROUTES[revName]; displayName = revName; }
  }
  if(!selectedRoute) return;
  tableTitle.textContent = displayName;
  renderTimetable(selectedRoute);
  timetableCard.style.display='block';
  stationControls.style.display='block';
  clearTimer();
  timerDisplay.textContent='--:--';
  timerDisplay.style.background='var(--good)';
  statusDiv.textContent='';
}

function renderTimetable(route){
  tableBody.innerHTML='';
  const nextDep = getNextDeparture(new Date(), route.freq);
  for(let i=0;i<route.stops.length;i++){
    const stop = route.stops[i];
    const arrival = new Date(nextDep.getTime() + (stop.offset||i)*60000);
    const tr = document.createElement('tr');
    const td1 = document.createElement('td'); td1.textContent = stop.name || stop;
    const td2 = document.createElement('td'); td2.textContent = formatTime(arrival);
    tr.appendChild(td1); tr.appendChild(td2);
    tableBody.appendChild(tr);
  }
}

function getNextDeparture(now, freq){
  const mins = now.getMinutes();
  const rem = mins % freq;
  const next = new Date(now);
  const add = rem === 0 ? freq : freq - rem;
  next.setMinutes(mins + add);
  next.setSeconds(0,0);
  return next;
}

setInterval(()=>{
  const n = new Date();
  currentTime.textContent = n.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  if(selectedRoute){
    const next = getNextDeparture(n, selectedRoute.freq);
    nextDeparture.textContent = formatTime(next);
    const diff = Math.ceil((next - n)/1000);
    countdown.textContent = diff>0 ? `${Math.floor(diff/60)}m ${diff%60}s` : '0m 0s';
  }
},1000);

function formatTime(d){ return d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }
function formatDiffSec(s){
  s = Math.floor(Math.abs(s));
  const mm = Math.floor(s/60).toString().padStart(2,'0');
  const ss = (s%60).toString().padStart(2,'0');
  return `${mm}:${ss}`;
}

/* --- Station timers --- */
departBtn.addEventListener('click', ()=> {
  if(!selectedRoute) { alert('Load a route first'); return; }
  logShift(CURRENT_USER, tableTitle.textContent || lineSelect.value);
  currentStopIndex = 0;
  startStopTimerForIndex(currentStopIndex);
  statusDiv.textContent = `Departed: ${selectedRoute.stops[currentStopIndex].name || selectedRoute.stops[currentStopIndex]}`;
});

nextBtn.addEventListener('click', ()=> {
  if(!selectedRoute) return;
  const secRemaining = Math.ceil((expectedArrival - new Date())/1000);
  if(secRemaining > 15 && (expectedArrival - new Date()) > 0){
    statusDiv.textContent = `You can click Next Station only in the last 15s before arrival. (${secRemaining}s left)`;
    return;
  }
  const diff = Math.floor((new Date() - expectedArrival)/1000);
  if(diff <= 0){
    statusDiv.innerHTML = `<span class="ok">On Time ✅</span> &nbsp;(${formatDiffSec(Math.abs(diff))})`;
  } else {
    statusDiv.innerHTML = `<span class="danger">Late ❌</span> &nbsp;(-${formatDiffSec(diff)})`;
  }
  currentStopIndex++;
  if(currentStopIndex >= selectedRoute.stops.length){ endRoute(); return; }
  startStopTimerForIndex(currentStopIndex);
});

endBtn.addEventListener('click', ()=> { endRoute(); });

function startStopTimerForIndex(index){
  clearTimer();
  expectedArrival = new Date(new Date().getTime() + 60000);
  updateTimerDisplay();
  timerInterval = setInterval(updateTimerDisplay,1000);
}

function updateTimerDisplay(){
  if(!expectedArrival){ timerDisplay.textContent='--:--'; return; }
  const diffSec = Math.ceil((expectedArrival - new Date())/1000);
  if(diffSec > 0){
    timerDisplay.style.background = 'var(--good)';
    timerDisplay.textContent = formatDiffSec(diffSec);
    nextBtn.disabled = diffSec > 15;
  } else {
    timerDisplay.style.background = 'var(--bad)';
    timerDisplay.textContent = '-' + formatDiffSec(Math.abs(diffSec));
    nextBtn.disabled = false;
  }
}

function clearTimer(){
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = null;
  expectedArrival = null;
  nextBtn.disabled = true;
}

function endRoute(){
  clearTimer();
  statusDiv.textContent = 'Route completed!';
  timerDisplay.textContent='--:--';
  timerDisplay.style.background='var(--good)';
  currentStopIndex = 0;
}

/* --- Shift logs --- */
function logShift(user, routeName){
  const entry = { user, route: routeName, time: new Date().toISOString() };
  LOGS.unshift(entry);
  saveLogs(LOGS);
  if(CURRENT_USER_IS_ADMIN) populateLogs();
}

function populateLogs(){
  logsList.innerHTML = '';
  if(!LOGS.length){ logsList.textContent = 'No shift logs yet'; return; }
  LOGS.forEach((l, idx)=>{
    const wrap = document.createElement('div'); wrap.className = 'logItem';
    const left = document.createElement('div'); left.innerHTML = `<strong>${l.user}</strong> - ${l.route} <div class="mutedSmall">${(new Date(l.time)).toLocaleString()}</div>`;
    const right = document.createElement('div');
    const del = document.createElement('button'); del.className='smallBtn'; del.textContent='Delete'; del.addEventListener('click', ()=> {
      if(!confirm('Delete this log?')) return;
      LOGS.splice(idx,1); saveLogs(LOGS); populateLogs();
    });
    right.appendChild(del);
    wrap.appendChild(left); wrap.appendChild(right);
    logsList.appendChild(wrap);
  });
}

/* --- Admin routes --- */
function populateAdminRoutes(){
  routesList.innerHTML = '';
  const names = Object.keys(ROUTES).sort();
  names.forEach(n=>{
    const div = document.createElement('div'); div.style.display='flex'; div.style.justifyContent='space-between'; div.style.alignItems='center'; div.style.marginBottom='8px';
    const left = document.createElement('div'); left.innerHTML = `<strong>${n}</strong> <div class="mutedSmall">${ROUTES[n].freq} min — ${ROUTES[n].stops.length} stops</div>`;
    const right = document.createElement('div');
    const delBtn = document.createElement('button'); delBtn.className='smallBtn'; delBtn.textContent='Delete'; delBtn.addEventListener('click', ()=>{
      if(!confirm(`Delete route "${n}" and its reverse?`)) return;
      deleteRouteAndReverse(n);
      populateAdminRoutes();
      populateRoutesSelect();
    });
    right.appendChild(delBtn);
    div.appendChild(left); div.appendChild(right);
    routesList.appendChild(div);
  });
}

function reverseName(name){ return name.endsWith(' 2')? name.replace(/ 2$/,'') : (name + ' 2'); }

function deleteRouteAndReverse(name){
  const rev = name.endsWith(' 2')? name.replace(/ 2$/,'') : name + ' 2';
  if(ROUTES[name]) delete ROUTES[name];
  if(ROUTES[rev]) delete ROUTES[rev];
  saveRoutes(ROUTES);
}

/* add route by admin */
addRouteBtn.addEventListener('click', ()=>{
  const name = newRouteName.value.trim();
  const freq = parseInt(newRouteFreq.value,10) || 10;
  const stopsRaw = newRouteStops.value.trim();
  if(!name || !stopsRaw){ alert('Provide route name and stops.'); return; }
  const arr = stopsRaw.split(/\r?\n|,/).map(s=>s.trim()).filter(Boolean);
  const stopsObj = arr.map((s,i)=> ({name:s, offset:i}) );
  ROUTES[name] = { freq, stops: stopsObj };
  const revName = name + ' 2';
  if(!ROUTES[revName]){
    const revStops = [...stopsObj].slice().reverse().map((s,i)=> ({ name: s.name, offset: i }));
    ROUTES[revName] = { freq, stops: revStops };
  }
  saveRoutes(ROUTES);
  populateAdminRoutes();
  populateRoutesSelect();
  newRouteName.value=''; newRouteFreq.value=''; newRouteStops.value='';
});

refreshRoutesBtn.addEventListener('click', ()=> { populateAdminRoutes(); populateRoutesSelect(); });

clearLogsBtn.addEventListener('click', ()=>{
  if(!confirm('Clear all logs?')) return;
  LOGS=[]; saveLogs(LOGS); populateLogs();
});

exportLogsBtn.addEventListener('click', ()=>{
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(LOGS,null,2));
  const dl = document.createElement('a'); dl.setAttribute('href',dataStr); dl.setAttribute('download','shift_logs.json'); dl.click();
});
</script>

</body>
</html>

