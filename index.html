<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>OVS</title>
<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#ff6b6b;--muted:#9aa4c0;--good:#1cc88a;--bad:#e43f5a;--panel:#0f3460}
*{box-sizing:border-box}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071024 0%,#0e1530 100%);color:#edf2f7;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
header{padding:18px 24px;border-bottom:1px solid rgba(255,255,255,.03);display:flex;align-items:center;gap:12px}
h1{margin:0;font-size:18px}
.wrap{display:flex;gap:20px;padding:20px;max-width:1200px;margin:20px auto}
.card{background:var(--card);border-radius:12px;padding:18px;width:360px;box-shadow:0 6px 30px rgba(2,6,23,.6)}
.wide{flex:1;min-width:360px;padding:18px}
label{display:block;font-size:13px;color:var(--muted);margin-top:8px}
input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:0;font-size:14px}
textarea{min-height:88px;resize:vertical}
button{background:var(--accent);color:#fff;border:0;cursor:pointer}
.muted{color:var(--muted);font-size:13px}
.infoRow{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:10px}
.big{font-weight:700;font-size:18px}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;text-align:left;border-bottom:1px solid rgba(255,255,255,.03);font-size:14px}
th{color:#fff;background:linear-gradient(90deg,var(--accent),#ff907a);border-radius:6px}
.smallBtn{padding:6px 8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,.06);color:var(--muted);cursor:pointer}
#activeDrivers{position:fixed;left:18px;bottom:18px;background:var(--panel);padding:12px;border-radius:10px;min-width:200px;box-shadow:0 8px 30px rgba(0,0,0,.6)}
#activeDrivers h3{margin:0 0 6px 0;color:var(--good);font-size:14px}
.timer{margin-top:12px;padding:10px;border-radius:8px;text-align:center;font-weight:700;font-size:20px;color:#fff;background:var(--good);min-width:120px}
.status{margin-top:8px;font-weight:600}
.adminPanel{background:#07183a;padding:12px;border-radius:10px}
.row{display:flex;gap:8px}
.row > *{flex:1}
.mutedSmall{font-size:12px;color:var(--muted)}
.logItem{display:flex;justify-content:space-between;gap:10px;align-items:center;padding:8px;border-radius:6px;background:rgba(255,255,255,.02);margin-bottom:8px}
.danger{background:rgba(228,63,90,.08);border:1px solid rgba(228,63,90,.12);color:var(--bad);padding:6px 8px;border-radius:8px}
.ok{background:rgba(28,200,138,.06);border:1px solid rgba(28,200,138,.12);color:var(--good);padding:6px 8px;border-radius:8px}
.inlineSmall{display:inline-block;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,.02);color:var(--muted);font-size:13px}
</style>
</head>
<body>
<header>
<h1>Openbaar Vervoer systeem</h1>
<div style="margin-left:auto" class="mutedSmall">Local demo — data saved in browser storage</div>
</header>

<div class="wrap">
  <!-- Left column: login + driver controls -->
  <div class="card">
    <div id="loginSection">
      <h2 style="margin:0 0 8px 0">Login</h2>
      <label>Username</label>
      <input id="username" placeholder="username" />
      <label>Password</label>
      <input id="password" type="password" placeholder="password" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="loginBtn">Login</button>
        <button id="logoutBtn" style="display:none;background:#6c757d">Logout</button>
      </div>
      <div id="loginMsg" class="mutedSmall" style="margin-top:8px;color:#ffb4b4"></div>
    </div>

    <div id="driverControls" style="display:none;margin-top:12px">
      <h3 style="margin:0 0 8px 0">Driver Controls</h3>
      <label>Choose Line</label>
      <select id="lineSelect"></select>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="confirmBtn">Load Timetable</button>
        <button id="reverseBtn" title="Toggle original/return" class="smallBtn">Reverse</button>
      </div>
      <div class="infoRow">
        <div>
          <div class="mutedSmall">Current time</div>
          <div id="currentTime" class="big"></div>
        </div>
        <div style="text-align:right">
          <div class="mutedSmall">Next departure</div>
          <div id="nextDeparture" class="big">--:--</div>
        </div>
      </div>
      <div style="margin-top:10px">
        <div class="mutedSmall">Countdown to next departure</div>
        <div id="countdown" class="timer">--:--</div>
      </div>
      <div id="stationControls" style="display:none;margin-top:12px">
        <div style="display:flex;gap:8px">
          <button id="departBtn">Vertrek</button>
          <button id="nextBtn" disabled>Volgende halte</button>
          <button id="endBtn">Einde</button>
        </div>
        <div id="currentStation" class="status" style="margin-top:6px"></div>
        <div id="timerDisplay" class="timer" style="margin-top:10px;background:var(--good)">--:--</div>
        <div id="status" class="status mutedSmall"></div>
        <div style="margin-top:8px" class="mutedSmall">*Next Station button only in last 15s before arrival or when late.</div>
      </div>
    </div>
  </div>

  <!-- Middle: timetable / logs -->
  <div class="wide card" style="min-width:520px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="margin:0">Paneel</h2>
      <div id="userBadge" class="inlineSmall" style="display:none"></div>
    </div>
    <div id="timetableCard" style="margin-top:12px; display:none">
      <div class="mutedSmall">Timetable for <strong id="tableTitle"></strong></div>
      <table id="timetableTable">
        <thead><tr><th>Stop</th><th>Arrival</th></tr></thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <!-- admin panel -->
    <div id="adminPanel" style="margin-top:16px;display:none" class="adminPanel">
      <h3 style="margin:0 0 8px 0;color:var(--good)">Admin Panel</h3>
      <div style="display:flex;gap:10px">
        <div style="flex:1">
          <label>New Route name</label>
          <input id="newRouteName" placeholder="e.g. Lijn X" />
          <label>Frequency (minutes)</label>
          <input id="newRouteFreq" placeholder="10" />
          <label>Stops (one per line or comma separated)</label>
          <textarea id="newRouteStops" placeholder="Spawn&#10;Chinatown&#10;Fire Department"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="addRouteBtn">Add Route</button>
            <button id="refreshRoutesBtn" class="smallBtn">Refresh</button>
          </div>
          <hr style="border:none;border-top:1px solid rgba(255,255,255,.03);margin:12px 0">
          <label>Create User</label>
          <input id="newUsername" placeholder="username">
          <input id="newPassword" type="password" placeholder="password">
          <button id="createUserBtn" style="margin-top:6px">Create User</button>
          <label style="margin-top:10px">Give Strikes</label>
          <select id="strikeSelect"></select>
          <input id="strikeAmount" placeholder="Number of strikes" type="number">
          <button id="giveStrikeBtn" style="margin-top:6px">Give Strike</button>
        </div>
        <div style="width:260px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="mutedSmall">Routes</div>
            <div class="mutedSmall">Actions</div>
          </div>
          <div id="routesList" style="margin-top:8px;max-height:280px;overflow:auto"></div>
          <div style="margin-top:12px" class="mutedSmall">Shift Logs</div>
          <div id="logsList" style="margin-top:8px;max-height:220px;overflow:auto"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Active drivers -->
<div id="activeDrivers" style="display:none">
  <h3>Active Drivers</h3>
  <ul id="driversList" style="margin:0;padding-left:18px"></ul>
</div>

<script>
/* ------------------------- Storage / Defaults ------------------------- */
const STORAGE_USERS='erlc_users_v3';
const STORAGE_ROUTES='erlc_routes_v3';
const STORAGE_LOGS='erlc_logs_v3';
const STORAGE_ACTIVE='erlc_activeDrivers_v3';
const STORAGE_STRIKES='erlc_strikes_v3';
const STORAGE_ROUTE_OWNERS='erlc_routeOwners_v3';

const defaultUsers = {
  "pwatg123admin": {pw:"utrechtov20092025",admin:true},
  "Roidkyadmin": {pw:"Mohamed4obai",admin:true},
  "Roidky": {pw:"Mohamed4obai",admin:false},
  "pwatg123": {pw:"utrechtov20092025",admin:false},
  "Ilias123": {pw:"Pass123",admin:false},
  "milandepro7": {pw:"Utrechtov20702025",admin:false},
  "blobvisje.": {pw:"pass123",admin:false}
};

const defaultRoutes = {
  "Lijn 6": {freq:10,stops:["Spawn","Fire Department","Central Park","P+R Transferium","Farms","Highrock"]},
  "Lijn 7 Shuttlebus": {freq:10,stops:["Spawn","Fire Department","Central Park","Hostpital"]},
  "Lijn 8 Shuttlebus": {freq:10,stops:["Spawn","Repair shop","P+R Transferium"]},
  "Lijn 9": {freq:10,stops:["Spawn","Chinatown","Fire Department","Central Park","Hospital","Farms","Highrock","Springfield"]},
  "FastLine": {freq:8,stops:["Springfield","River City"]}
};

/* ------------------------- Helpers ------------------------- */
function save(key,value){localStorage.setItem(key,JSON.stringify(value))}
function load(key,fallback){const raw=localStorage.getItem(key);return raw?JSON.parse(raw):fallback}

function saveUsers(u){save(STORAGE_USERS,u);USERS=u}
function loadUsers(){return load(STORAGE_USERS,defaultUsers)}
function saveRoutes(r){save(STORAGE_ROUTES,r);ROUTES=r}
function loadRoutes(){
  let r=load(STORAGE_ROUTES,null);
  if(!r){ r=JSON.parse(JSON.stringify(defaultRoutes));
    for(const name in defaultRoutes){
      const rev=name+' 2';
      if(!r[rev]) r[rev]={freq:defaultRoutes[name].freq,stops:[...defaultRoutes[name].stops].reverse()};
    }
    saveRoutes(r);
  }
  return r;
}
function saveLogs(l){save(STORAGE_LOGS,l);LOGS=l}
function loadLogs(){return load(STORAGE_LOGS,[])}
function saveActive(a){save(STORAGE_ACTIVE,a);ACTIVE_DRIVERS=a}
function loadActive(){return load(STORAGE_ACTIVE,[])}
function saveStrikes(s){save(STORAGE_STRIKES,s);STRIKES=s}
function loadStrikes(){return load(STORAGE_STRIKES,{})}
function saveRouteOwners(o){save(STORAGE_ROUTE_OWNERS,o);ROUTE_OWNERS=o}
function loadRouteOwners(){return load(STORAGE_ROUTE_OWNERS,{})}

/* ------------------------- Variables ------------------------- */
let USERS=loadUsers();
let ROUTES=loadRoutes();
let LOGS=loadLogs();
let ACTIVE_DRIVERS=loadActive();
let STRIKES=loadStrikes();
let ROUTE_OWNERS=loadRouteOwners();

let CURRENT_USER=null;
let CURRENT_USER_IS_ADMIN=false;
let selectedRouteName=null;
let selectedRoute=null;
let useReverse=false;
let actualDepartureTime=null;
let currentStopIndex=0;
let timerInterval=null;
let nextDepartureTimeForRoute=null;

/* ------------------------- DOM Elements ------------------------- */
const usernameEl=document.getElementById('username');
const passwordEl=document.getElementById('password');
const loginBtn=document.getElementById('loginBtn');
const logoutBtn=document.getElementById('logoutBtn');
const loginMsg=document.getElementById('loginMsg');
const driverControls=document.getElementById('driverControls');
const lineSelect=document.getElementById('lineSelect');
const confirmBtn=document.getElementById('confirmBtn');
const reverseBtn=document.getElementById('reverseBtn');
const currentTimeEl=document.getElementById('currentTime');
const nextDepartureEl=document.getElementById('nextDeparture');
const countdownEl=document.getElementById('countdown');
const stationControls=document.getElementById('stationControls');
const departBtn=document.getElementById('departBtn');
const nextBtn=document.getElementById('nextBtn');
const endBtn=document.getElementById('endBtn');
const currentStationEl=document.getElementById('currentStation');
const timerDisplay=document.getElementById('timerDisplay');
const statusEl=document.getElementById('status');
const tableBody=document.getElementById('tableBody');
const tableTitle=document.getElementById('tableTitle');
const timetableCard=document.getElementById('timetableCard');
const userBadge=document.getElementById('userBadge');

/* Admin DOM */
const adminPanel=document.getElementById('adminPanel');
const newRouteName=document.getElementById('newRouteName');
const newRouteFreq=document.getElementById('newRouteFreq');
const newRouteStops=document.getElementById('newRouteStops');
const addRouteBtn=document.getElementById('addRouteBtn');
const refreshRoutesBtn=document.getElementById('refreshRoutesBtn');
const createUserBtn=document.getElementById('createUserBtn');
const newUsername=document.getElementById('newUsername');
const newPassword=document.getElementById('newPassword');
const strikeSelect=document.getElementById('strikeSelect');
const strikeAmount=document.getElementById('strikeAmount');
const giveStrikeBtn=document.getElementById('giveStrikeBtn');
const routesList=document.getElementById('routesList');
const logsList=document.getElementById('logsList');
const activeDriversPanel=document.getElementById('activeDrivers');
const driversList=document.getElementById('driversList');

/* ------------------------- Login ------------------------- */
loginBtn.addEventListener('click',()=>{
  const u=usernameEl.value.trim();
  const p=passwordEl.value;
  if(!u || !p){ loginMsg.textContent='Enter username & password'; return; }
  const user=USERS[u];
  if(!user || user.pw!==p){ loginMsg.textContent='Invalid credentials'; return; }
  CURRENT_USER=u;
  CURRENT_USER_IS_ADMIN=user.admin;
  loginMsg.textContent='';
  usernameEl.value='';
  passwordEl.value='';
  document.getElementById('loginSection').style.display='none';
  driverControls.style.display='block';
  logoutBtn.style.display='inline-block';
  userBadge.style.display='inline-block';
  userBadge.textContent=u;
  if(CURRENT_USER_IS_ADMIN) adminPanel.style.display='block';
  populateRoutesSelect();
  populateAdminLists();
  renderActiveDrivers();
});

/* Logout */
logoutBtn.addEventListener('click',()=>{
  CURRENT_USER=null;
  CURRENT_USER_IS_ADMIN=false;
  document.getElementById('loginSection').style.display='block';
  driverControls.style.display='none';
  logoutBtn.style.display='none';
  userBadge.style.display='none';
  adminPanel.style.display='none';
  tableBody.innerHTML='';
  timetableCard.style.display='none';
  clearInterval(timerInterval);
});

/* ------------------------- Populate Route Select ------------------------- */
function populateRoutesSelect(){
  lineSelect.innerHTML='';
  Object.keys(ROUTES).sort().forEach(r=>{
    const opt=document.createElement('option');
    opt.value=r;
    opt.textContent=r;
    lineSelect.appendChild(opt);
  });
}

/* ------------------------- Timetable Logic ------------------------- */
function computeNextDepartureTime(freq){
  const now=new Date();
  const h=now.getHours();
  const m=now.getMinutes();
  const nextMin=Math.ceil(m/freq)*freq;
  const dep=new Date(now);
  dep.setSeconds(0);
  dep.setMilliseconds(0);
  dep.setMinutes(nextMin);
  if(nextMin>=60){ dep.setHours(h+1); dep.setMinutes(0); }
  return dep;
}

function renderTimetable(route){
  tableBody.innerHTML='';
  tableTitle.textContent=selectedRouteName+(useReverse?' (Return)':'');
  let startTime=actualDepartureTime||new Date();
  route.stops.forEach((stop,i)=>{
    const tr=document.createElement('tr');
    const tdStop=document.createElement('td'); tdStop.textContent=stop;
    const tdTime=document.createElement('td');
    const arrTime=new Date(startTime.getTime()+i*60000); // +1 min per stop
    tdTime.textContent=arrTime.toLocaleTimeString().slice(0,5);
    tr.appendChild(tdStop);
    tr.appendChild(tdTime);
    tableBody.appendChild(tr);
  });
  timetableCard.style.display='block';
}

/* Load timetable */
confirmBtn.addEventListener('click',()=>{
  selectedRouteName=lineSelect.value;
  useReverse=false;
  selectedRoute=ROUTES[selectedRouteName];
  nextDepartureTimeForRoute=computeNextDepartureTime(selectedRoute.freq);
  currentStopIndex=0;
  actualDepartureTime=null;
  renderTimetable(selectedRoute);
  updateCountdown();
});

/* Toggle reverse */
reverseBtn.addEventListener('click',()=>{
  useReverse=!useReverse;
  const baseName=selectedRouteName.replace(/ 2$/,'');
  selectedRouteName=useReverse?baseName+' 2':baseName;
  selectedRoute=ROUTES[selectedRouteName];
  renderTimetable(selectedRoute);
});

/* Countdown timer */
function updateCountdown(){
  if(!nextDepartureTimeForRoute) return;
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    const now=new Date();
    const diff=Math.floor((nextDepartureTimeForRoute-now)/1000);
    if(diff<0){ countdownEl.textContent='00:00'; return; }
    const m=Math.floor(diff/60).toString().padStart(2,'0');
    const s=(diff%60).toString().padStart(2,'0');
    countdownEl.textContent=`${m}:${s}`;
    currentTimeEl.textContent=now.toLocaleTimeString().slice(0,8);
  },500);
}

/* ------------------------- Depart / Next / End ------------------------- */
departBtn.addEventListener('click',()=>{
  actualDepartureTime=new Date();
  currentStopIndex=0;
  stationControls.style.display='block';
  renderTimetable(selectedRoute);
  currentStationEl.textContent='Current Stop: '+selectedRoute.stops[currentStopIndex];
  updateStationTimer();
  // Add driver to active
  if(!ACTIVE_DRIVERS.includes(CURRENT_USER)){
    ACTIVE_DRIVERS.push(CURRENT_USER);
    saveActive(ACTIVE_DRIVERS);
    renderActiveDrivers();
  }
});

function updateStationTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    const now=new Date();
    const expected=new Date(actualDepartureTime.getTime()+currentStopIndex*60000);
    const diff=Math.floor((expected-now)/1000);
    const status=Math.abs(diff)<60?'On Time':(diff>0?'Too Early':'Late');
    const prefix=(diff>0?'-':diff<0?'+':'')+Math.abs(Math.floor(diff/60));
    statusEl.textContent=`${status} ${prefix} min`;
    timerDisplay.textContent=expected.toLocaleTimeString().slice(0,5);
    if(currentStopIndex<selectedRoute.stops.length-1){
      nextBtn.disabled=diff>15;
    }
  },500);
}

nextBtn.addEventListener('click',()=>{
  currentStopIndex++;
  if(currentStopIndex>=selectedRoute.stops.length){
    alert('End of route');
    return;
  }
  currentStationEl.textContent='Current Stop: '+selectedRoute.stops[currentStopIndex];
});

endBtn.addEventListener('click',()=>{
  clearInterval(timerInterval);
  stationControls.style.display='none';
  actualDepartureTime=null;
  // Remove from active drivers
  const idx=ACTIVE_DRIVERS.indexOf(CURRENT_USER);
  if(idx!==-1){ ACTIVE_DRIVERS.splice(idx,1); saveActive(ACTIVE_DRIVERS); renderActiveDrivers(); }
  // Log shift
  LOGS.push({user:CURRENT_USER,route:selectedRouteName,time:new Date().toISOString()});
  saveLogs(LOGS);
  renderLogs();
});

/* ------------------------- Admin: Add / Refresh Routes ------------------------- */
addRouteBtn.addEventListener('click', ()=>{
  const name=(newRouteName.value||'').trim();
  const freq=parseInt(newRouteFreq.value||'10',10);
  const stopsRaw=(newRouteStops.value||'').trim();
  if(!name||!stopsRaw){ alert('Provide route name and stops'); return; }
  const stops=stopsRaw.split(/\r?\n|,/).map(s=>s.trim()).filter(Boolean);
  if(stops.length<2){ alert('Need at least 2 stops'); return; }
  ROUTES[name]={freq:freq||10,stops};
  const rev=name+' 2';
  ROUTES[rev]={freq:freq||10,stops:[...stops].reverse()};
  saveRoutes(ROUTES);
  populateRoutesSelect();
  populateAdminLists();
  newRouteName.value=''; newRouteFreq.value=''; newRouteStops.value='';
});

refreshRoutesBtn.addEventListener('click',()=>{
  ROUTES=loadRoutes();
  populateRoutesSelect();
  populateAdminLists();
});

/* ------------------------- Admin: Create User ------------------------- */
createUserBtn.addEventListener('click',()=>{
  const u=(newUsername.value||'').trim();
  const p=newPassword.value||'';
  if(!u||!p){ alert('Provide username & password'); return; }
  if(USERS[u]){ alert('User already exists'); return; }
  USERS[u]={pw:p,admin:false};
  saveUsers(USERS);
  newUsername.value=''; newPassword.value='';
  alert(`Created user ${u}`);
  populateAdminLists();
});

/* ------------------------- Admin: Give Strike ------------------------- */
giveStrikeBtn.addEventListener('click',()=>{
  const u=strikeSelect.value;
  const amt=parseInt(strikeAmount.value||'1',10);
  if(!u){ alert('Select user'); return; }
  STRIKES[u]=(STRIKES[u]||0)+amt;
  saveStrikes(STRIKES);
  populateAdminLists();
  alert(`Gave ${amt} strike(s) to ${u}. Total: ${STRIKES[u]}`);
});

/* ------------------------- Populate Admin Lists ------------------------- */
function populateAdminLists(){
  // Routes
  routesList.innerHTML='';
  Object.keys(ROUTES).sort().forEach(name=>{
    const div=document.createElement('div');
    div.style.display='flex';
    div.style.justifyContent='space-between';
    div.style.alignItems='center';
    div.style.marginBottom='8px';
    const left=document.createElement('div');
    left.innerHTML=`<strong>${name}</strong> <div class="mutedSmall">${ROUTES[name].freq} min — ${ROUTES[name].stops.length} stops</div>`;
    const right=document.createElement('div');
    const delBtn=document.createElement('button');
    delBtn.className='smallBtn';
    delBtn.textContent='Delete';
    delBtn.addEventListener('click',()=>{
      if(!confirm(`Delete route "${name}" and its reverse?`)) return;
      delete ROUTES[name];
      const rev=name.endsWith(' 2')? name.replace(/ 2$/,'') : name+' 2';
      if(ROUTES[rev]) delete ROUTES[rev];
      saveRoutes(ROUTES);
      populateRoutesSelect();
      populateAdminLists();
    });
    right.appendChild(delBtn);
    div.appendChild(left); div.appendChild(right);
    routesList.appendChild(div);
  });

  // Strike select
  strikeSelect.innerHTML='';
  Object.keys(USERS).sort().forEach(u=>{
    const opt=document.createElement('option');
    opt.value=u;
    opt.textContent=u;
    strikeSelect.appendChild(opt);
  });

  // Logs
  renderLogs();
}

/* ------------------------- Render Logs ------------------------- */
function renderLogs(){
  logsList.innerHTML='';
  if(!LOGS.length){ logsList.textContent='No shift logs'; return; }
  LOGS.forEach((l,idx)=>{
    const wrap=document.createElement('div'); wrap.className='logItem';
    const left=document.createElement('div');
    left.innerHTML=`<strong>${l.user}</strong> - ${l.route} <div class="mutedSmall">${new Date(l.time).toLocaleString()}</div>`;
    const right=document.createElement('div');
    const del=document.createElement('button');
    del.className='smallBtn';
    del.textContent='Delete';
    del.addEventListener('click',()=>{
      if(!confirm('Delete this log?')) return;
      LOGS.splice(idx,1);
      saveLogs(LOGS);
      renderLogs();
    });
    right.appendChild(del);
    wrap.appendChild(left); wrap.appendChild(right);
    logsList.appendChild(wrap);
  });
}

/* ------------------------- Active Drivers ------------------------- */
function renderActiveDrivers(){
  if(!ACTIVE_DRIVERS.length){ activeDriversPanel.style.display='none'; return; }
  activeDriversPanel.style.display='block';
  driversList.innerHTML='';
  ACTIVE_DRIVERS.forEach(u=>{
    const li=document.createElement('li'); li.textContent=u; driversList.appendChild(li);
  });
}

/* ------------------------- Initialization ------------------------- */
populateRoutesSelect();
populateAdminLists();
renderActiveDrivers();
</script>
</body>
</html>
