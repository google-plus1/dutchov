<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ERLC Bus Scheduler</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #a8edea, #fed6e3); margin:0; padding:0; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
  h1,h2 { margin:0 0 10px 0; text-align:center; color:#333; }
  .container { display:flex; flex-wrap:wrap; justify-content:center; gap:20px; padding:40px 20px; width:100%; max-width:1200px; }
  .card { background:white; border-radius:16px; padding:25px; box-shadow:0 10px 25px rgba(0,0,0,0.1); width:320px; display:flex; flex-direction:column; align-items:center; }
  input, select, button { width:100%; padding:10px; margin:8px 0; border-radius:12px; border:1px solid #ccc; font-size:16px; }
  button { background:#ff7e5f; color:white; border:none; cursor:pointer; font-weight:bold; transition:0.3s; }
  button:hover { background:#eb6750; }
  .info { margin:12px 0; width:100%; text-align:center; }
  .label { font-weight:bold; color:#555; }
  .big { font-size:22px; color:#ff7e5f; }
  .timetable { width:100%; max-width:400px; background:#fefefe; border-radius:16px; padding:20px; box-shadow:0 10px 25px rgba(0,0,0,0.1); }
  table { width:100%; border-collapse:collapse; }
  th, td { padding:8px; text-align:left; border-bottom:1px solid #eee; }
  th { background:#ff7e5f; color:white; border-radius:8px; }
</style>
</head>
<body>

<h1>ERLC Bus Scheduler</h1>

<div class="container">
  <!-- LOGIN -->
  <div class="card" id="loginCard">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button id="loginBtn">Login</button>
    <div id="loginMsg" style="color:red; margin-top:10px;"></div>
  </div>

  <!-- BUS CONTROLS -->
  <div class="card" id="busCard" style="display:none;">
    <h2>Bus Schedule</h2>
    <select id="lineSelect"></select>
    <button id="confirmBtn">Select Route</button>

    <div class="info"><span class="label">Current Time:</span><br><span id="currentTime" class="big"></span></div>
    <div class="info"><span class="label">Next Departure:</span><br><span id="nextDeparture" class="big"></span></div>
    <div class="info"><span class="label">Countdown:</span><br><span id="countdown" class="big"></span></div>
  </div>

  <!-- TIMETABLE -->
  <div class="timetable" id="timetableCard" style="display:none;">
    <h2 id="tableTitle">Timetable</h2>
    <table>
      <thead><tr><th>Stop</th><th>Arrival</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>

<script>
// === USERS DATABASE ===
const users = { "admin":"1234", "driver":"pass123" };

// === BUS LINES ===
const lines = {
  "Line A": { freq:10, stops:[ {name:"Spawn (Depart)",offset:0},{name:"Brandweer Kazerene",offset:1},{name:"Independence Parkway",offset:2},{name:"Centraal Station",offset:3},{name:"Maple Valley Farms",offset:4},{name:"Highrock Park (End)",offset:5} ] },
  "Event Shuttle": { freq:15, stops:[ {name:"Spawn (Depart)",offset:0},{name:"Event Center",offset:4} ] },
  "Line B": { freq:15, stops:[ {name:"Central Park (Depart)",offset:0},{name:"Ouchard Boulevard",offset:1},{name:"Ouchard Boulevard 2",offset:2},{name:"Independence Parkway",offset:3},{name:"Medical Way",offset:4},{name:"Maple Valley Farms",offset:5},{name:"Highrock Park (End)",offset:6} ] },
  "Line C": { freq:10, stops:[ {name:"Spawn (Depart)",offset:0},{name:"Chinatown",offset:1},{name:"Fire Department",offset:2},{name:"Central Park",offset:3},{name:"Hospital",offset:4},{name:"Farms",offset:5},{name:"Highrock",offset:6},{name:"Springfield (End)",offset:7} ] }
};

const loginCard = document.getElementById("loginCard");
const busCard = document.getElementById("busCard");
const timetableCard = document.getElementById("timetableCard");

const loginBtn = document.getElementById("loginBtn");
const usernameEl = document.getElementById("username");
const passwordEl = document.getElementById("password");
const loginMsg = document.getElementById("loginMsg");

const select = document.getElementById("lineSelect");
const confirmBtn = document.getElementById("confirmBtn");
const currentTimeEl = document.getElementById("currentTime");
const nextDepartureEl = document.getElementById("nextDeparture");
const countdownEl = document.getElementById("countdown");
const tableBody = document.getElementById("tableBody");
const tableTitle = document.getElementById("tableTitle");

// LOGIN
loginBtn.addEventListener("click", ()=> {
  const username=usernameEl.value;
  const password=passwordEl.value;
  if(users[username] && users[username]===password){
    loginCard.style.display="none";
    busCard.style.display="block";
    timetableCard.style.display="block";
    loginMsg.textContent="";
    initBusUI();
  } else loginMsg.textContent="Invalid username or password!";
});

// BUS UI
let selectedLine=null;
function initBusUI(){
  select.innerHTML="";
  for(let name in lines){
    const opt=document.createElement("option");
    opt.value=name;
    opt.textContent=name;
    select.appendChild(opt);
  }
  confirmBtn.addEventListener("click",()=>{
    selectedLine=lines[select.value];
    tableTitle.textContent=`${select.value} Timetable`;
    generateTimetable(selectedLine);
  });
  setInterval(updateTime,1000);
  updateTime();
}

// NEXT DEPARTURE
function getNextDeparture(now,freq){
  const mins=now.getMinutes();
  const rem=mins%freq;
  const next=new Date(now);
  const add=rem===0?freq:freq-rem;
  next.setMinutes(mins+add);
  next.setSeconds(0,0);
  return next;
}

// GENERATE TIMETABLE
function generateTimetable(line){
  tableBody.innerHTML="";
  if(!line) return;
  const nextDeparture=getNextDeparture(new Date(),line.freq);
  line.stops.forEach(stop=>{
    const tr=document.createElement("tr");
    const tdStop=document.createElement("td");
    const tdTime=document.createElement("td");
    tdStop.textContent=stop.name;
    const arrival=new Date(nextDeparture.getTime()+stop.offset*60000);
    tdTime.textContent=arrival.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    tr.append(tdStop,tdTime);
    tableBody.appendChild(tr);
  });
}

// LIVE TIME & COUNTDOWN
function updateTime(){
  const now=new Date();
  currentTimeEl.textContent=now.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit',second:'2-digit'});
  if(!selectedLine){
    nextDepartureEl.textContent="--:--";
    countdownEl.textContent="Select a line";
    return;
  }
  const freq=selectedLine.freq;
  const next=getNextDeparture(now,freq);
  const diff=next-now;
  const mins=Math.floor(diff/60000);
  const secs=Math.floor((diff%60000)/1000);
  nextDepartureEl.textContent=next.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  countdownEl.textContent=`${mins}m ${secs}s`;
}
</script>
</body>
</html>
